<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8" />
    <title>项目进度</title>

    <!-- 引入模板中head定义的公共js和css等内容 -->
    <script th:replace="~{common/linkData :: linkData}"></script>

    <!--必须的css引用-->
    <link th:href="@{/Content/bootstrap/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/Content/bootstrap3-editable/css/bootstrap-editable.css}" rel="stylesheet" />
    <link th:href="@{/Content/bootstrap-table/bootstrap-table.min.css}"  rel="stylesheet" />
</head>
<body>
    <div class="panel-body" style="padding-bottom:0px;">
        <div id="toolbar" class="btn-group">
            <button id="btn_add" type="button" class="btn btn-success">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
            </button>
        </div>
        <table id="tb_user"></table>
    </div>

    <!--新增或者编辑的弹出框-->
    <form th:action="@{/sugarManage/newlyAdded}">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">操作</h4>
                </div>
                <div class="modal-body">
                    <div class="row" style="padding:10px;">
                        <label class="control-label col-xs-2">产品类型</label>
                        <div class="col-xs-10">
                            <input type="text" name="productType" class="form-control" placeholder="产品类型">
                        </div>
                    </div>
                    <div class="row" style="padding:10px;">
                        <label class="control-label col-xs-2">平台名称</label>
                        <div class="col-xs-10">
                            <input type="text" name="platformName" class="form-control" placeholder="平台名称">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>
                    <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>
                </div>
                
            </div>
        </div>
    </div>
    </form>
        <!--必须的js文件-->
        <script th:src="@{/Content/jquery-1.9.1.min.js}"></script>
        <script th:src="@{/Content/bootstrap/js/bootstrap.min.js}"></script>
        <script th:src="@{/Content/bootstrap3-editable/js/bootstrap-editable.js}"></script>
        <script th:src="@{/Content/bootstrap-table/bootstrap-table.min.js}"></script>
        <script th:src="@{/Content/bootstrap-table/locale/bootstrap-table-zh-CN.min.js}"></script>
        <script th:src="@{/Content/bootstrap-table/extensions/editable/bootstrap-table-editable.min.js}"></script>
        <script type="text/javascript">
            //页面加载完成之后
            var data = [
                { Id: 1, Name: 'Jim', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 2, Name: 'Kate', Age: 30, School: '光明小学', Address: '深圳市', Remark: 'My Name is Jim Green' },
                { Id: 3, Name: 'Lucy', Age: 30, School: '光明小学', Address: '广州天河机场', Remark: 'My Name is Jim Green' },
                { Id: 4, Name: 'Lilei', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 5, Name: 'Lintao', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 6, Name: 'Lily', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 7, Name: 'Hanmeimei', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 8, Name: '张三', Age: 46, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 9, Name: '李四', Age: 23, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 10, Name: '王五', Age: 33, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 11, Name: '赵六', Age: 22, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 12, Name: 'Polly', Age: 300, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 13, Name: 'Uncle', Age: 50, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
            ];
            var childData = [
                { SourceField: 'A', BackField: 'BB' },
                { SourceField: 'CC', BackField: 'UU' },
                { SourceField: 'DD', BackField: 'J' },
            ];
            $(function () {
                

                //表格的初始化
                $('#tb_user').bootstrapTable({
                    url: WEB_ROOT + "/sugarManage/getSugarProjectList",
                    //data: data,                         //直接从本地数据初始化表格
                    method: 'get',                      //请求方式（*）
                    toolbar: '#toolbar',                //工具按钮用哪个容器
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sortable: false,                     //是否启用排序
                    sortOrder: "asc",                   //排序方式
                    queryParams: function (params) {
                        return params;
                    },                                  //传递参数（*）
                    sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                      //初始化加载第一页，默认第一页
                    pageSize: 10,                       //每页的记录行数（*）
                    pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                    search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                    strictSearch: true,
                    showColumns: true,                  //是否显示所有的列

                    showRefresh: true,                  //是否显示刷新按钮
                    minimumCountColumns: 2,             //最少允许的列数
                    clickToSelect: true,                //是否启用点击选中行
                    uniqueId: "Id",                     //每一行的唯一标识，一般为主键列
                    showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
                    cardView: false,                    //是否显示详细视图
                    detailView: false,                   //是否显示父子表
		    selectItemName: 'parentItem',
                    //注册加载子表的事件。注意下这里的三个参数！
                    onExpandRow: function (index, row, $detail) {
                        InitSubTable(index, row, $detail);
                    },
                    columns: [{
                        title: '序号',
                        field: 'id',
                        //checkbox: true
                    }, {
                        field: 'productType',
                        title: '产品类型',
                        editable: {
                            type: 'text',
                            title: '产品类型',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    }, {
                        field: 'platformName',
                        title: '平台名称',
                        editable: {
                            type: 'text',
                            title: '平台名称',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'demandReview',
                        title: '需求评审',
                        editable: {
                            type: 'text',
                            title: '需求评审',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                        
                    }, {
                        field: 'demandConfirm',
                        title: '需求单确认',
                        editable: {
                            type: 'text',
                            title: '需求单确认',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'demandCheck',
                        title: '验收',
                        editable: {
                            type: 'text',
                            title: '验收',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'technologySelection',
                        title: '技术选型',
                        editable: {
                            type: 'text',
                            title: '技术选型',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'environmentDeployment',
                        title: '环境部署',
                        editable: {
                            type: 'text',
                            title: '环境部署',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'frameworkDesign',
                        title: '框架设计',
                        editable: {
                            type: 'text',
                            title: '框架设计',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress10',
                        title: '开发进度10%',
                        editable: {
                            type: 'text',
                            title: '开发进度10%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress25',
                        title: '开发进度25%',
                        editable: {
                            type: 'text',
                            title: '开发进度25%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress50',
                        title: '开发进度50%',
                        editable: {
                            type: 'text',
                            title: '开发进度50%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress75',
                        title: '开发进度75%',
                        editable: {
                            type: 'text',
                            title: '开发进度75%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress100',
                        title: '开发进度100%',
                        editable: {
                            type: 'text',
                            title: '开发进度100%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'insideTest',
                        title: '内部测试优化',
                        editable: {
                            type: 'text',
                            title: '内部测试优化',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'customerTest',
                        title: '客户测试优化',
                        editable: {
                            type: 'text',
                            title: '客户测试优化',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'implementDeliver',
                        title: '实施交付',
                        editable: {
                            type: 'text',
                            title: '实施交付',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'checkDeliver',
                        title: '验收',
                        editable: {
                            type: 'text',
                            title: '验收',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        title: '操作',
                        formatter: function (value, row, index) {//这里的三个参数：value表示当前行当前列的值；row表示当前行的数据；index表示当前行的索引（从0开始）。
                            var html = '<button type="button" onclick="editModel('+row.id+')" class="btn btn-primary"><span class="glyphicon glyphicon-pencil" aria- hidden="true" ></span >编辑</button >&nbsp;&nbsp;' +
                                       '<button type="button" onclick="deleteModel('+row.id+')" class="btn btn-danger"><span class="glyphicon glyphicon-remove" aria- hidden="true" ></span >删除</button >';

                            return html;
                        }
                    }],
                    onEditableSave: function (field, row, oldValue, $el) {
                       // alert("更新保存事件，原始值为" + oldValue);
                        $.ajax({
                           type: "post",
                           url: WEB_ROOT + "/sugarManage/Edit",
                           data: row,
                           dataType: 'JSON',
                           success: function (status) {
                                   alert('提交数据成功');
                           },
                           error: function () {
                               alert('编辑失败');
                           },
                           complete: function () {

                           }

                        });
                    }
                });

                //新增事件
                $("#btn_add").on('click', function () {
                    $('#tb_user').bootstrapTable("resetView");
                    //弹出模态框
                    $("#myModal").modal();
                    //给弹出框里面的各个文本框赋值
                    $("#myModal input").val("");
                    $("#myModal textarea").val("");
                });
                
            });

            //加载子表
            var InitSubTable = function (index, row, $detail) {
                var parentid = row.MENU_ID;
                var cur_table = $detail.html('<table></table>').find('table');
                //子表的初始化和父表完全相同
                $(cur_table).bootstrapTable({
                    //url: '/api/MenuApi/GetChildrenMenu',
                    data: childData,
                    method: 'get',
                    queryParams: { strParentID: parentid },
                    ajaxOptions: { strParentID: parentid },
                    clickToSelect: true,
                    uniqueId: "MENU_ID",
                    pageSize: 10,
                    pageList: [10, 25],
		    selectItemName: 'childItem'+index,
		    checkboxHeader:false,
                    columns: [{
                        checkbox: true
                    }, {
                            field: 'SourceField',
                        title: '源端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }],
                    //无线循环取子表，直到子表里面没有记录
                    onExpandRow: function (index, row, $Subdetail) {
                        //oInit.InitSubTable(index, row, $Subdetail);
                    }
                });
            };

            //编辑事件
            var editModel = function (id) {
                //根据当前行的id获取当前的行数据
                var row = $("#tb_user").bootstrapTable('getRowByUniqueId', id);
                //弹出模态框
                $("#myModal").modal();
                //给弹出框里面的各个文本框赋值
                $("#myModal input[name='Name']").val(row.Name);
                $("#myModal input[name='Age']").val(row.Age);
                $("#myModal input[name='School']").val(row.School);
                $("#myModal input[name='Address']").val(row.Address);
                $("#myModal textarea[name='Remark']").val(row.Remark);
            }

            //删除事件

            var deleteModel = function (id) {
                alert("删除id为" + id + "的用户");
                $.ajax({
                    type: "post",
                    url: WEB_ROOT + "/sugarManage/delete",
                    data: "id="+id,
                    dataType: 'JSON',
                    success: function (status) {
                        alert('删除成功');
                        location.reload();
                    },
                    error: function () {
                        alert('删除失败');
                    }

                });

            }
        </script>
</body>
</html>