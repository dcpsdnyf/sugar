<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8" />
    <title>项目进度</title>

    <!-- 引入模板中head定义的公共js和css等内容 -->
    <script th:replace="~{common/linkData :: linkData}"></script>

    <!--必须的css引用-->
    <link th:href="@{/Content/bootstrap/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/Content/bootstrap3-editable/css/bootstrap-editable.css}" rel="stylesheet" />
    <link th:href="@{/Content/bootstrap-table/bootstrap-table.min.css}"  rel="stylesheet" />
</head>
<body>
    <div class="panel-body" style="padding-bottom:0px;">
        <div id="toolbar" class="btn-group">
            <button id="btn_add" type="button" class="btn btn-success">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
        </button>
            <button id="btn_export" type="button" class="btn btn-success" onclick="exportSugar()">
                <i class="glyphicon glyphicon-export"></i>导出
            </button>
        </div>
        <table id="tb_user"></table>
    </div>

    <!--新增或者编辑的弹出框-->
    <form th:action="@{/sugarManage/newlyAdded}">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">操作</h4>
                </div>
                <div class="modal-body">
                    <div class="row" style="padding:10px;">
                        <label class="control-label col-xs-2">产品类型</label>
                        <div class="col-xs-10">
                            <input type="text" name="productType" class="form-control" placeholder="产品类型">
                        </div>
                    </div>
                    <div class="row" style="padding:10px;">
                        <label class="control-label col-xs-2">平台名称</label>
                        <div class="col-xs-10">
                            <input type="text" name="platformName" class="form-control" placeholder="平台名称">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>
                    <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>
                </div>
                
            </div>
        </div>
    </div>
    </form>
        <!--必须的js文件-->
        <script th:src="@{/Content/jquery-1.9.1.min.js}"></script>
        <script th:src="@{/Content/bootstrap/js/bootstrap.min.js}"></script>
        <script th:src="@{/Content/bootstrap3-editable/js/bootstrap-editable.js}"></script>
        <script th:src="@{/Content/bootstrap-table/bootstrap-table.min.js}"></script>
        <script th:src="@{/Content/bootstrap-table/locale/bootstrap-table-zh-CN.min.js}"></script>
        <script th:src="@{/Content/bootstrap-table/extensions/editable/bootstrap-table-editable.min.js}"></script>
        <script type="text/javascript">
            //页面加载完成之后
            var data = [
                { Id: 1, Name: 'Jim', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 2, Name: 'Kate', Age: 30, School: '光明小学', Address: '深圳市', Remark: 'My Name is Jim Green' },
                { Id: 3, Name: 'Lucy', Age: 30, School: '光明小学', Address: '广州天河机场', Remark: 'My Name is Jim Green' },
                { Id: 4, Name: 'Lilei', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 5, Name: 'Lintao', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 6, Name: 'Lily', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 7, Name: 'Hanmeimei', Age: 30, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 8, Name: '张三', Age: 46, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 9, Name: '李四', Age: 23, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 10, Name: '王五', Age: 33, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 11, Name: '赵六', Age: 22, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 12, Name: 'Polly', Age: 300, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
                { Id: 13, Name: 'Uncle', Age: 50, School: '光明小学', Address: '北京市光明小学旁', Remark: 'My Name is Jim Green' },
            ];
            var childData = [
                { SourceField: 'A', BackField: 'BB' },
                { SourceField: 'CC', BackField: 'UU' },
                { SourceField: 'DD', BackField: 'J' },
            ];
            $(function () {

                //表格的初始化
                $('#tb_user').bootstrapTable({
                    url: WEB_ROOT + "/sugarManage/getSugarProjectList",
                    //data: data,                         //直接从本地数据初始化表格
                    method: 'get',                      //请求方式（*）
                    toolbar: '#toolbar',                //工具按钮用哪个容器
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sortable: false,                     //是否启用排序
                    sortOrder: "asc",                   //排序方式
                    queryParams: function (params) {
                        var temp = {                    //如果是在服务器端实现分页，limit、offset这两个参数是必须的
                            limit : params.limit,       // 每页显示数量
                            offset : params.offset,     // SQL语句起始索引
                            page : (params.offset / params.limit) + 1, //当前页码
                            /*Name : $('#search_name').val(),
                            Tel : $('#search_tel').val()*/
                        };
                        return temp;
                    },                                  //传递参数（*）
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                      //初始化加载第一页，默认第一页
                    pageSize: 10,                       //每页的记录行数（*）
                    pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                    search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                    strictSearch: true,
                    showColumns: true,                  //是否显示所有的列

                    showRefresh: true,                  //是否显示刷新按钮
                    minimumCountColumns: 2,             //最少允许的列数
                    clickToSelect: true,                //是否启用点击选中行
                    uniqueId: "Id",                     //每一行的唯一标识，一般为主键列
                    showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
                    cardView: false,                    //是否显示详细视图
                    detailView: false,                   //是否显示父子表

		    selectItemName: 'parentItem',
                    //注册加载子表的事件。注意下这里的三个参数！
                    onExpandRow: function (index, row, $detail) {
                        InitSubTable(index, row, $detail);
                    },
                    columns: [{
                        title: '序号',
                        field: 'id',
                        formatter: function(value, row, index){
                            return index + 1;
                        }
                    }, {
                        field: 'productType',
                        title: '产品类型',
                        editable: {
                            type: 'text',
                            title: '产品类型',
                            button:true,
                            validate: function (v) {
                                if (!v) return '用户名不能为空';
                            },
                            toggleDisabled: function (v,row,index) {
                               /* var q=row.roleaType;
                                var  w=q.split(",");
                                for (var i=0;i<w.length;i++){
                                    if(w[i]==3) {
                                        return 1;
                                    }
                                }return 1;*/
                               return true;
                            },
                        },

                    }, {
                        field: 'platformName',
                        title: '平台名称',
                        editable: {
                            type: 'text',
                            title: '平台名称',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';
                            },

                        }
                    }, {
                        field: 'businessClueOpen',
                        title: '商机线索开启',
                        editable: {

                            type: 'text',
                            title: '商机线索开启',

                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }



                        }

                    },{
                        field: 'businessClue0',
                        title: '1、商机线索0%：我方分析客户存在潜在需求',
                        editable: {
                            type: 'text',
                            title: '1、商机线索0%：我方分析客户存在潜在需求',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            },

                        }

                    },{
                        field: 'businessDiscover10',
                        title: '2、商机发现10%：深入交流明确需求',
                        editable: {
                            type: 'text',
                            title: '2、商机发现10%：深入交流明确需求',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'businessEstablish25',
                        title: '3、商机确立25%：客户明确购买意愿/立项/预算',
                        editable: {
                            type: 'text',
                            title: '3、商机确立25%：客户明确购买意愿/立项/预算',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'businessEstablish50',
                        title: '4、商机确立50%：客户启动招标/采购流程、我方入围',
                        editable: {
                            type: 'text',
                            title: '4、商机确立50%：客户启动招标/采购流程、我方入围',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'businessEstablish75',
                        title: '5、商机确认75%：客户招标/采购，我方交流需求细则',
                        editable: {
                            type: 'text',
                            title: '5、商机确认75%：客户招标/采购，我方交流需求细则',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'businessWin100',
                        title: '6、商机赢取100%：合同签订',
                        editable: {
                            type: 'text',
                            title: '6、商机赢取100%：合同签订',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'customerMaintainBackMoney',
                        title: '7、客户维护/回款阶段',
                        editable: {
                            type: 'text',
                            title: '7、客户维护/回款阶段',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'businessClose',
                        title: '商机关闭',
                        editable: {
                            type: 'text',
                            title: '商机关闭',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'initialIntentionPlan',
                        title: '1、初步意向方案',
                        editable: {
                            type: 'text',
                            title: '1、初步意向方案',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'writeProjectProposal',
                        title: '2、写立项方案',
                        editable: {
                            type: 'text',
                            title: '2、写立项方案',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'workingHoursAssess',
                        title: '3、工时评估',
                        editable: {
                            type: 'text',
                            title: '3、工时评估',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'businessNegotiation',
                        title: '4、商务谈判',
                        editable: {
                            type: 'text',
                            title: '4、商务谈判',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'requestDraft',
                        title: '5、请示拟写',
                        editable: {
                            type: 'text',
                            title: '5、请示拟写',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'attendMeeting',
                        title: '6、上会',
                        editable: {
                            type: 'text',
                            title: '6、上会',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'bidding',
                        title: '7、招投标',
                        editable: {
                            type: 'text',
                            title: '7、招投标',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'requestOaApproval',
                        title: '8、请示OA审批',
                        editable: {
                            type: 'text',
                            title: '8、请示OA审批',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'contractDraft',
                        title: '9、合同拟写',
                        editable: {
                            type: 'text',
                            title: '9、合同拟写',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'lawyerReview',
                        title: '10、律师审核',
                        editable: {
                            type: 'text',
                            title: '10、律师审核',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'contractOaApproval',
                        title: '11、合同OA审批',
                        editable: {
                            type: 'text',
                            title: '11、合同OA审批',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'usageSeal',
                        title: '12、用章',
                        editable: {
                            type: 'text',
                            title: '12、用章',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'otherSeal',
                        title: '13、对方盖章',
                        editable: {
                            type: 'text',
                            title: '13、对方盖章',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'scan',
                        title: '14、扫描',
                        editable: {
                            type: 'text',
                            title: '14、扫描',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'generalDepartmentFile',
                        title: '15、综合部归档',
                        editable: {
                            type: 'text',
                            title: '15、综合部归档',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'firstPayment',
                        title: '16、首付款',
                        editable: {
                            type: 'text',
                            title: '16、首付款',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'progressPayment',
                        title: '17、进度款',
                        editable: {
                            type: 'text',
                            title: '17、进度款',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'finalPayment',
                        title: '18、尾款',
                        editable: {
                            type: 'text',
                            title: '18、尾款',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'designBrief',
                        title: '1、设计概要',
                        editable: {
                            type: 'text',
                            title: '1、设计概要',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'detailedDesign',
                        title: '2、详细设计',
                        editable: {
                            type: 'text',
                            title: '2、详细设计',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'uiDesign',
                        title: '3、UI设计',
                        editable: {
                            type: 'text',
                            title: '3、UI设计',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'requirementDesign',
                        title: '4、需求设计',
                        editable: {
                            type: 'text',
                            title: '4、需求设计',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'requirementsReview',
                        title: '5、需求评审',
                        editable: {
                            type: 'text',
                            title: '5、需求评审',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'demandOrderConfirm',
                        title: '6、需求单确认',
                        editable: {
                            type: 'text',
                            title: '6、需求单确认',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    },{
                        field: 'proCheckDeliver',
                        title: '7、验收',
                        editable: {
                            type: 'text',
                            title: '7、验收',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }

                    }, {
                        field: 'technologySelection',
                        title: '1、技术选型',
                        editable: {
                            type: 'text',
                            title: '1、技术选型',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';
                            }
                        }
                    }, {
                        field: 'environmentDeployment',
                        title: '2、环境部署',
                        editable: {
                            type: 'text',
                            title: '2、环境部署',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'frameworkDesign',
                        title: '3、框架设计',
                        editable: {
                            type: 'text',
                            title: '3、框架设计',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress10',
                        title: '4、开发进度10%',
                        editable: {
                            type: 'text',
                            title: '4、开发进度10%',
                            validate: function (v) {
                                if (!v) {
                                    return '用户名不能为空';
                                }
                            }
                        }
                    }, {
                        field: 'developProgress25',
                        title: '5、开发进度25%',
                        editable: {
                            type: 'text',
                            title: '5、开发进度25%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress50',
                        title: '6、开发进度50%',
                        editable: {
                            type: 'text',
                            title: '6、开发进度50%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress75',
                        title: '7、开发进度75%',
                        editable: {
                            type: 'text',
                            title: '7、开发进度75%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'developProgress100',
                        title: '8、开发进度100%',
                        editable: {
                            type: 'text',
                            title: '8、开发进度100%',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'insideTest',
                        title: '9、内部测试优化',
                        editable: {
                            type: 'text',
                            title: '9、内部测试优化',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'customerTest',
                        title: '10、客户测试优化',
                        editable: {
                            type: 'text',
                            title: '10、客户测试优化',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'implementDeliver',
                        title: '11、实施交付',
                        editable: {
                            type: 'text',
                            title: '11、实施交付',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    }, {
                        field: 'checkDeliver',
                        title: '12、验收',
                        editable: {
                            type: 'text',
                            title: '12、验收',
                            validate: function (v) {
                                if (!v) return '用户名不能为空';

                            }
                        }
                    },{
                            field: 'operationPhase',
                            title: '运营阶段',
                            editable: {
                                type: 'text',
                                title: '运营阶段',
                                validate: function (v) {
                                    if (!v) return '用户名不能为空';

                                }
                            }
                        },{
                            field: 'maintainPhase',
                            title: '运维阶段',

                            editable: {
                                type: 'text',
                                title: '运维阶段',
                                validate: function (v) {
                                    if (!v) return '用户名不能为空';

                                }
                            }
                        }, {
                        title: '操作',
                        formatter: function (value, row, index) {//这里的三个参数：value表示当前行当前列的值；row表示当前行的数据；index表示当前行的索引（从0开始）。
                            var html = '<button type="button" onclick="editModel('+row.id+')" class="btn btn-primary"><span class="glyphicon glyphicon-pencil" aria- hidden="true" ></span >编辑</button >&nbsp;&nbsp;' +
                                       '<button type="button" onclick="deleteModel('+row.id+')" class="btn btn-danger"><span class="glyphicon glyphicon-remove" aria- hidden="true" ></span >删除</button >';

                            return html;
                        }
                    }],
                    onEditableSave: function (field, row, oldValue, $el) {
                       // alert("更新保存事件，原始值为" + oldValue);
                        $.ajax({
                           type: "post",
                           url: WEB_ROOT + "/sugarManage/Edit",
                           data: row,
                           dataType: 'JSON',
                           success: function (status) {
                                   alert('提交数据成功');
                                   location.reload();
                           },
                           error: function () {
                               alert('编辑失败');
                           },
                           complete: function () {

                           }

                        });
                    },
                    onLoadSuccess: function (data) {
                        //var data = $('#tb_user').bootstrapTable('getData', true);
                        var rows = data.rows;
                        var roleTypes=rows[0].roleType;
                        for(var k=0;k<rows.length;k++){
                            //======================商机推进阶段======================
                            var businessClueOpen = rows[k].businessClueOpen; //商机线索
                            var businessClose = rows[k].businessClose;  //商机关闭
                            var businessClue0 = rows[k].businessClue0;  //1、商机线索0%：我方分析客户存在潜在需求
                            var businessDiscover10= rows[k].businessDiscover10; //2、商机发现10%：深入交流明确需求
                            var businessEstablish25= rows[k].businessEstablish25;//3、商机确立25%：客户明确购买意愿/立项/预算
                            var businessEstablish50= rows[k].businessEstablish50;//4、商机确立50%：客户启动招标/采购流程、我方入围
                            var businessEstablish75= rows[k].businessEstablish75;//5、商机确认75%：客户招标/采购，我方交流需求细则
                            var businessWin100= rows[k].businessWin100;          // 6、商机赢取100%：合同签订
                            var customerMaintainBackMoney= rows[k].customerMaintainBackMoney;// 7、客户维护/回款阶段
                            //======================采购阶段======================
                            var initialIntentionPlan= rows[k].initialIntentionPlan;     //1、初步意向方案（采购阶段）
                            var writeProjectProposal= rows[k].writeProjectProposal;     // 2、写立项方案
                            var workingHoursAssess= rows[k].workingHoursAssess;         // 3、工时评估
                            var businessNegotiation= rows[k].businessNegotiation;       // 4、商务谈判
                            var requestDraft= rows[k].requestDraft;                     // 5、请示拟写
                            var attendMeeting= rows[k].attendMeeting;                   // 6、上会
                            var bidding= rows[k].bidding;                               // 7、招投标
                            var requestOaApproval= rows[k].requestOaApproval;           // 8、请示OA审批
                            var contractDraft= rows[k].contractDraft;                   // 9、合同拟写
                            var lawyerReview= rows[k].lawyerReview;                     // 10、律师审核
                            var contractOaApproval= rows[k].contractOaApproval;         // 11、合同OA审批
                            var usageSeal= rows[k].usageSeal;                           // 12、用章
                            var otherSeal= rows[k].otherSeal;                           // 13、对方盖章
                            var scan= rows[k].scan;                                     // 14、扫描
                            var generalDepartmentFile= rows[k].generalDepartmentFile;   // 15、综合部归档
                            var firstPayment= rows[k].firstPayment;                     // 16、首付款
                            var progressPayment= rows[k].progressPayment;               // 17、进度款
                            var finalPayment= rows[k].finalPayment;                     // 18、尾款
                            //======================产品阶段======================
                            var designBrief= rows[k].designBrief;                       // 1、设计概要
                            var detailedDesign= rows[k].detailedDesign;                 // 2、详细设计
                            var uiDesign= rows[k].uiDesign;                             // 3、UI设计
                            var requirementDesign= rows[k].requirementDesign;           // 4、需求设计
                            var requirementsReview= rows[k].requirementsReview;         // 5、需求评审
                            var demandOrderConfirm= rows[k].demandOrderConfirm;         // 6、需求单确认
                            var proCheckDeliver= rows[k].proCheckDeliver;               // 7、验收

                            //======================研发阶段======================
                            var technologySelection = rows[k].technologySelection;      //1、技术选型
                            var environmentDeployment = rows[k].environmentDeployment;  //2、环境部署
                            var frameworkDesign = rows[k].frameworkDesign;              //  3、框架设计
                            var developProgress10 = rows[k].developProgress10;          //4、开发进度10%
                            var developProgress25 = rows[k].developProgress25;          //5、开发进度25%
                            var developProgress50 = rows[k].developProgress50;          //6、开发进度50%
                            var developProgress75 = rows[k].developProgress75;          //7、开发进度75%
                            var developProgress100 = rows[k].developProgress100;        //8、开发进度100%
                            var insideTest = rows[k].insideTest;                        //9、内部测试优化
                            var customerTest = rows[k].customerTest;                    //10、客户测试优化
                            var implementDeliver = rows[k].implementDeliver;            //11、实施交付
                            var checkDeliver = rows[k].checkDeliver;                    //12、验收

                            //======================运营阶段======================
                            var operationPhase = rows[k].operationPhase;

                            //======================运营阶段======================
                            var maintainPhase = rows[k].maintainPhase;

                            if(roleTypes.indexOf('1')==-1){ //项目名称
                                var obj1 = $('#tb_user tr[data-index='+k+'] a[data-name="businessClueOpen"]').parent();
                                $(obj1).empty();
                                $(obj1).text(businessClueOpen);

                                var obj2 = $('#tb_user tr[data-index='+k+'] a[data-name="businessClose"]').parent();
                                $(obj2).empty();
                                $(obj2).text(businessClose);
                            }
                            if(roleTypes.indexOf('2')==-1){
                                var obj1 = $('#tb_user tr[data-index='+k+'] a[data-name="businessClue0"]').parent();
                                $(obj1).empty();
                                $(obj1).text(businessClue0);

                                var obj2 = $('#tb_user tr[data-index='+k+'] a[data-name="businessDiscover10"]').parent();
                                $(obj2).empty();
                                $(obj2).text(businessDiscover10);

                                var obj3 = $('#tb_user tr[data-index='+k+'] a[data-name="businessEstablish25"]').parent();
                                $(obj3).empty();
                                $(obj3).text(businessEstablish25);

                                var obj4 = $('#tb_user tr[data-index='+k+'] a[data-name="businessEstablish50"]').parent();
                                $(obj4).empty();
                                $(obj4).text(businessEstablish50);

                                var obj5 = $('#tb_user tr[data-index='+k+'] a[data-name="businessEstablish75"]').parent();
                                $(obj5).empty();
                                $(obj5).text(businessEstablish75);

                                var obj6 = $('#tb_user tr[data-index='+k+'] a[data-name="businessWin100"]').parent();
                                $(obj6).empty();
                                $(obj6).text(businessWin100);

                                var obj7 = $('#tb_user tr[data-index='+k+'] a[data-name="customerMaintainBackMoney"]').parent();
                                $(obj7).empty();
                                $(obj7).text(customerMaintainBackMoney);
                            }
                            if(roleTypes.indexOf('3')==-1){
                                var obj1 = $('#tb_user tr[data-index='+k+'] a[data-name="initialIntentionPlan"]').parent();
                                $(obj1).empty();
                                $(obj1).text(initialIntentionPlan);

                                var obj2 = $('#tb_user tr[data-index='+k+'] a[data-name="writeProjectProposal"]').parent();
                                $(obj2).empty();
                                $(obj2).text(writeProjectProposal);

                                var obj3 = $('#tb_user tr[data-index='+k+'] a[data-name="workingHoursAssess"]').parent();
                                $(obj3).empty();
                                $(obj3).text(workingHoursAssess);

                                var obj4 = $('#tb_user tr[data-index='+k+'] a[data-name="businessNegotiation"]').parent();
                                $(obj4).empty();
                                $(obj4).text(businessNegotiation);

                                var obj5 = $('#tb_user tr[data-index='+k+'] a[data-name="requestDraft"]').parent();
                                $(obj5).empty();
                                $(obj5).text(requestDraft);

                                var obj6 = $('#tb_user tr[data-index='+k+'] a[data-name="attendMeeting"]').parent();
                                $(obj6).empty();
                                $(obj6).text(attendMeeting);

                                var obj7 = $('#tb_user tr[data-index='+k+'] a[data-name="bidding"]').parent();
                                $(obj7).empty();
                                $(obj7).text(bidding);

                                var obj8 = $('#tb_user tr[data-index='+k+'] a[data-name="requestOaApproval"]').parent();
                                $(obj8).empty();
                                $(obj8).text(requestOaApproval);

                                var obj9 = $('#tb_user tr[data-index='+k+'] a[data-name="contractDraft"]').parent();
                                $(obj9).empty();
                                $(obj9).text(contractDraft);

                                var obj10 = $('#tb_user tr[data-index='+k+'] a[data-name="lawyerReview"]').parent();
                                $(obj10).empty();
                                $(obj10).text(lawyerReview);

                                var obj11 = $('#tb_user tr[data-index='+k+'] a[data-name="contractOaApproval"]').parent();
                                $(obj11).empty();
                                $(obj11).text(contractOaApproval);

                                var obj12 = $('#tb_user tr[data-index='+k+'] a[data-name="usageSeal"]').parent();
                                $(obj12).empty();
                                $(obj12).text(usageSeal);

                                var obj13 = $('#tb_user tr[data-index='+k+'] a[data-name="otherSeal"]').parent();
                                $(obj13).empty();
                                $(obj13).text(otherSeal);

                                var obj14 = $('#tb_user tr[data-index='+k+'] a[data-name="scan"]').parent();
                                $(obj14).empty();
                                $(obj14).text(scan);

                                var obj15 = $('#tb_user tr[data-index='+k+'] a[data-name="generalDepartmentFile"]').parent();
                                $(obj15).empty();
                                $(obj15).text(generalDepartmentFile);

                                var obj16 = $('#tb_user tr[data-index='+k+'] a[data-name="firstPayment"]').parent();
                                $(obj16).empty();
                                $(obj16).text(firstPayment);

                                var obj17 = $('#tb_user tr[data-index='+k+'] a[data-name="progressPayment"]').parent();
                                $(obj17).empty();
                                $(obj17).text(progressPayment);

                                var obj18 = $('#tb_user tr[data-index='+k+'] a[data-name="finalPayment"]').parent();
                                $(obj18).empty();
                                $(obj18).text(finalPayment);

                            }
                            if(roleTypes.indexOf('4')==-1){
                                var obj1 = $('#tb_user tr[data-index='+k+'] a[data-name="designBrief"]').parent();
                                $(obj1).empty();
                                $(obj1).text(designBrief);

                                var obj2 = $('#tb_user tr[data-index='+k+'] a[data-name="detailedDesign"]').parent();
                                $(obj2).empty();
                                $(obj2).text(detailedDesign);

                                var obj3 = $('#tb_user tr[data-index='+k+'] a[data-name="uiDesign"]').parent();
                                $(obj3).empty();
                                $(obj3).text(uiDesign);

                                var obj4 = $('#tb_user tr[data-index='+k+'] a[data-name="requirementDesign"]').parent();
                                $(obj4).empty();
                                $(obj4).text(requirementDesign);

                                var obj5 = $('#tb_user tr[data-index='+k+'] a[data-name="requirementsReview"]').parent();
                                $(obj5).empty();
                                $(obj5).text(requirementsReview);

                                var obj6 = $('#tb_user tr[data-index='+k+'] a[data-name="demandOrderConfirm"]').parent();
                                $(obj6).empty();
                                $(obj6).text(demandOrderConfirm);

                                var obj7 = $('#tb_user tr[data-index='+k+'] a[data-name="proCheckDeliver"]').parent();
                                $(obj7).empty();
                                $(obj7).text(proCheckDeliver);
                            }

                            if(roleTypes.indexOf('5')==-1){
                                var obj1 = $('#tb_user tr[data-index='+k+'] a[data-name="technologySelection"]').parent();
                                $(obj1).empty();
                                $(obj1).text(technologySelection);

                                var obj2 = $('#tb_user tr[data-index='+k+'] a[data-name="environmentDeployment"]').parent();
                                $(obj12).empty();
                                $(obj2).text(environmentDeployment);

                                var obj3 = $('#tb_user tr[data-index='+k+'] a[data-name="frameworkDesign"]').parent();
                                $(obj3).empty();
                                $(obj3).text(frameworkDesign);

                                var obj4 = $('#tb_user tr[data-index='+k+'] a[data-name="developProgress10"]').parent();
                                $(obj4).empty();
                                $(obj4).text(developProgress10);

                                var obj5 = $('#tb_user tr[data-index='+k+'] a[data-name="developProgress25"]').parent();
                                $(obj5).empty();
                                $(obj5).text(developProgress25);

                                var obj6 = $('#tb_user tr[data-index='+k+'] a[data-name="developProgress50"]').parent();
                                $(obj6).empty();
                                $(obj6).text(developProgress50);

                                var obj7 = $('#tb_user tr[data-index='+k+'] a[data-name="developProgress75"]').parent();
                                $(obj7).empty();
                                $(obj7).text(developProgress75);

                                var obj8 = $('#tb_user tr[data-index='+k+'] a[data-name="developProgress100"]').parent();
                                $(obj8).empty();
                                $(obj8).text(developProgress100);

                                var obj9 = $('#tb_user tr[data-index='+k+'] a[data-name="insideTest"]').parent();
                                $(obj9).empty();
                                $(obj9).text(insideTest);

                                var obj10 = $('#tb_user tr[data-index='+k+'] a[data-name="customerTest"]').parent();
                                $(obj10).empty();
                                $(obj10).text(customerTest);

                                var obj11 = $('#tb_user tr[data-index='+k+'] a[data-name="implementDeliver"]').parent();
                                $(obj11).empty();
                                $(obj11).text(implementDeliver);

                                var obj12 = $('#tb_user tr[data-index='+k+'] a[data-name="checkDeliver"]').parent();
                                $(obj12).empty();
                                $(obj12).text(checkDeliver);

                            }
                            if(roleTypes.indexOf('6')==-1){
                                var obj = $('#tb_user tr[data-index='+k+'] a[data-name="operationPhase"]').parent();
                                $(obj).empty();
                                $(obj).text(operationPhase);
                            }

                            if(roleTypes.indexOf('7')==-1){
                                var obj = $('#tb_user tr[data-index='+k+'] a[data-name="maintainPhase"]').parent();
                                $(obj).empty();
                                $(obj).text(maintainPhase);
                            }

                        }
                    }
                });

                //新增事件
                $("#btn_add").on('click', function () {
                    $('#tb_user').bootstrapTable("resetView");
                    //弹出模态框
                    $("#myModal").modal();
                    //给弹出框里面的各个文本框赋值
                    $("#myModal input").val("");
                    $("#myModal textarea").val("");
                });
                
            });

            //加载子表
            var InitSubTable = function (index, row, $detail) {
                var parentid = row.MENU_ID;
                var cur_table = $detail.html('<table></table>').find('table');
                //子表的初始化和父表完全相同
                $(cur_table).bootstrapTable({
                    //url: '/api/MenuApi/GetChildrenMenu',
                    data: childData,
                    method: 'get',
                    queryParams: { strParentID: parentid },
                    ajaxOptions: { strParentID: parentid },
                    clickToSelect: true,
                    uniqueId: "MENU_ID",
                    pageSize: 10,
                    pageList: [10, 25],
		    selectItemName: 'childItem'+index,
		    checkboxHeader:false,
                    columns: [{
                        checkbox: true
                    }, {
                            field: 'SourceField',
                        title: '源端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }, {
                        field: 'BackField',
                        title: '备端字段'
                    }],
                    //无线循环取子表，直到子表里面没有记录
                    onExpandRow: function (index, row, $Subdetail) {
                        //oInit.InitSubTable(index, row, $Subdetail);
                    }
                });
            };

            //编辑事件
            var editModel = function (id) {
                //根据当前行的id获取当前的行数据
                var row = $("#tb_user").bootstrapTable('getRowByUniqueId', id);
                //弹出模态框
                $("#myModal").modal();
                //给弹出框里面的各个文本框赋值
                $("#myModal input[name='Name']").val(row.Name);
                $("#myModal input[name='Age']").val(row.Age);
                $("#myModal input[name='School']").val(row.School);
                $("#myModal input[name='Address']").val(row.Address);
                $("#myModal textarea[name='Remark']").val(row.Remark);
            }

            //删除事件

            var deleteModel = function (id) {
                alert("删除id为" + id + "的用户");
                $.ajax({
                    type: "post",
                    url: WEB_ROOT + "/sugarManage/delete",
                    data: "id="+id,
                    dataType: 'JSON',
                    success: function (status) {
                        alert('删除成功');
                        location.reload();
                    },
                    error: function () {
                        alert('删除失败');
                    }

                });

            }
            function exportSugar() {
	            var url = WEB_ROOT + "/sugarManage/exportSugarExcle";
	            window.open(url);
            }
        </script>
</body>
</html>